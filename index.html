<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ’– Love Team Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #ffe6f2;
    text-align: center;
    margin: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.section {
    background: white;
    margin: 20px auto;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border-radius: 12px;
    box-shadow: 0 0 12px pink;
}

h1, h2 {
    color: #cc0066;
}

button {
    padding: 10px;
    width: 100%;
    background: #e60073;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 10px;
    cursor: pointer;
}

button.secondary {
    background: #999;
}

button:disabled {
    background: gray;
}

#reader {
    width: 280px;
    margin: auto;
}

.status {
    font-weight: bold;
    margin-top: 10px;
}

.loader {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #e60073;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 15px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.result {
    font-size: 28px;
    color: #e60073;
    margin-top: 10px;
}

.percent {
    font-size: 40px;
    font-weight: bold;
    color: #cc0066;
}
</style>
</head>

<body>

<!-- BACKGROUND MUSIC -->
<audio id="bgMusic" autoplay loop>
    <source src="cupid.mp3" type="audio/mpeg">
</audio>

<!-- BACKGROUND VIDEO -->
<video autoplay loop muted style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1;">
    <source src="hearts.mp4" type="video/mp4">
</video>

<!-- INTRO -->
<div class="section" id="intro">
    <h1>ğŸ’˜ Love Team Generator</h1>
    <p>Scan two ID QR codes to generate a Love Team.</p>
    <button onclick="goGuide()">Start</button>
    <button class="secondary" onclick="toggleMusic()">ğŸµ Music On / Off</button>
</div>

<!-- GUIDE -->
<div class="section" id="guide" style="display:none;">
    <h2>ğŸ“‹ User Guide</h2>
    <ol style="text-align:left;">
        <li>Allow camera access</li>
        <li>Scan the FIRST ID</li>
        <li>Wait for confirmation</li>
        <li>Scan the SECOND ID</li>
        <li>Generate Result</li>
    </ol>
    <button onclick="startScan()">Proceed to Scan</button>
</div>

<!-- SCANNER -->
<div class="section" id="scanner" style="display:none;">
    <h2>ğŸ“· QR Code Scanner</h2>
    <p class="status" id="scanStatus">Scan FIRST ID</p>

    <div id="reader"></div>

    <button id="generateBtn" onclick="generateLoveTeam()" disabled>
        Generate Love Team
    </button>
</div>

<!-- LOADING -->
<div class="section" id="loading" style="display:none;">
    <h2>ğŸ’ Generating Love Team...</h2>
    <div class="loader"></div>
    <p>Please wait (5 seconds)</p>
</div>

<!-- RESULT -->
<div class="section" id="resultSection" style="display:none;">
    <h2>â¤ï¸ Love Team Result â¤ï¸</h2>
    <div class="result" id="loveTeam"></div>
    <div class="percent" id="compatibility"></div>
    <p id="loveMessage"></p>
    <button onclick="resetSystem()">ğŸ”„ Scan Again</button>
</div>

<script>
/* VARIABLES */
let step = 1;
let firstName = "";
let secondName = "";
let scanner;
let scanLocked = false;

const messages = [
    "A match made in destiny ğŸ’•",
    "True love always finds a way ğŸ’–",
    "Perfect chemistry âœ¨",
    "Two hearts, one story ğŸ’",
    "Love shines brighter together â¤ï¸"
];

/* NAVIGATION */
function goGuide() {
    intro.style.display = "none";
    guide.style.display = "block";
    // Play music on user interaction for mobile compatibility
    const music = document.getElementById("bgMusic");
    music.play().catch(() => {});
}

function startScan() {
    guide.style.display = "none";
    scannerDiv.style.display = "block";

    scanner = new Html5Qrcode("reader");
    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 200 },
        onScanSuccess
    );
}

/* SCAN HANDLER (FIXED NOTIFICATION) */
function onScanSuccess(text) {
    if (scanLocked) return;
    scanLocked = true;

    const name = extractFirstName(text);

    if (step === 1) {
        firstName = name;
        // Removed alert showing first scanned name
        scanStatus.innerText = "âœ” First ID recorded. Scan SECOND ID";
        step = 2;

        setTimeout(() => {
            scanLocked = false;
        }, 1500);

    } else if (step === 2 && name !== firstName) {
        secondName = name;
        alert("Second Id done scan, proceed to generate result"); // updated message
        scanStatus.innerText = "âœ” Both IDs scanned successfully";

        // Change button text after scanning second ID
        generateBtn.innerText = "Generate Result";

        generateBtn.disabled = false;
        scanner.stop();
    }
}

/* GENERATE LOVE TEAM */
function generateLoveTeam() {
    scannerDiv.style.display = "none";
    loading.style.display = "block";

    setTimeout(() => {
        loading.style.display = "none";
        resultSection.style.display = "block";

        loveTeam.innerText = combineNames(firstName, secondName);
        compatibility.innerText = randomPercent() + "%";
        loveMessage.innerText =
            messages[Math.floor(Math.random() * messages.length)];
    }, 5000);
}

/* HELPERS */
function extractFirstName(text) {
    return text.trim().split(" ")[0].replace(/[^A-Za-z]/g, "");
}

function combineNames(a, b) {
    const aPart = a.substring(0, Math.ceil(a.length / 2));
    const bPart = b.substring(Math.floor(b.length / 2));
    const name = aPart + bPart;
    return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
}

function randomPercent() {
    return Math.floor(Math.random() * 21) + 80; // 80â€“100%
}

function resetSystem() {
    location.reload();
}

function toggleMusic() {
    const music = document.getElementById("bgMusic");
    music.paused ? music.play() : music.pause();
}

/* ELEMENT REFERENCES */
const intro = document.getElementById("intro");
const guide = document.getElementById("guide");
const scannerDiv = document.getElementById("scanner");
const loading = document.getElementById("loading");
const resultSection = document.getElementById("resultSection");

/* AUTO PLAY MUSIC */
window.addEventListener('load', () => {
    const music = document.getElementById("bgMusic");
    music.play().catch(() => {
        // Autoplay blocked, will play on user interaction
    });
});
</script>

</body>
</html>
