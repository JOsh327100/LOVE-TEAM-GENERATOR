<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üíñ Love Team Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #ffe6f2;
    text-align: center;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
    overflow: hidden;
}

#bgVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: -2;
}

.section {
    background: white;
    margin: 20px auto;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border-radius: 12px;
    box-shadow: 0 0 12px pink;
}

h1, h2 {
    color: #cc0066;
}

button {
    padding: 10px;
    width: 100%;
    background: #e60073;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    margin-top: 10px;
    cursor: pointer;
}

button.secondary {
    background: #999;
}

button:disabled {
    background: gray;
}

#reader {
    width: 280px;
    margin: auto;
}

.status {
    font-weight: bold;
    margin-top: 10px;
}

.loader {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #e60073;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 15px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.result {
    font-size: 28px;
    color: #e60073;
    margin-top: 10px;
}

.percent {
    font-size: 40px;
    font-weight: bold;
    color: #cc0066;
}


</style>
</head>

<body>

<!-- BACKGROUND MUSIC -->
<audio id="bgMusic" loop autoplay>
    <source src="cupid.mp3" type="audio/mpeg">
</audio>

<!-- BACKGROUND VIDEO -->
<video id="bgVideo" autoplay muted loop>
    <source src="hearts.mp4" type="video/mp4">
</video>

<!-- INTRO -->
<div class="section" id="intro">
    <h1>üíò Love Team Generator</h1>
    <p>Scan two ID QR codes to generate a Love Team.</p>
    <button onclick="goGuide()">Start</button>
    <button class="secondary" onclick="toggleMusic()">üéµ Music On / Off</button>
</div>

<!-- GUIDE -->
<div class="section" id="guide" style="display:none;">
    <h2>üìã User Guide</h2>
    <ol style="text-align:left;">
        <li>Allow camera access</li>
        <li>Scan the FIRST ID</li>
        <li>Wait for confirmation</li>
        <li>Scan the SECOND ID</li>
        <li>Generate Love Team</li>
    </ol>
    <button onclick="startScan()">Proceed to Scan</button>
</div>

<!-- SCANNER -->
<div class="section" id="scanner" style="display:none;">
    <h2>üì∑ QR Code Scanner</h2>
    <p class="status" id="scanStatus">Scan FIRST ID</p>

    <div id="reader"></div>

    <p id="firstResult"></p>
    <p id="secondResult"></p>

    <button id="generateBtn" onclick="generateLoveTeam()" disabled>
        Generate Love Team
    </button>
</div>

<!-- LOADING -->
<div class="section" id="loading" style="display:none;">
    <h2>üíû Generating Love Team...</h2>
    <div class="loader"></div>
    <p>Please wait (5 seconds)</p>
</div>

<!-- RESULT -->
<div class="section" id="resultSection" style="display:none;">
    <h2>‚ù§Ô∏è Love Team Result ‚ù§Ô∏è</h2>
    <div class="result" id="loveTeam"></div>
    <div class="percent" id="compatibility"></div>
    <p id="loveMessage"></p>
    <button onclick="resetSystem()">üîÑ Scan Again</button>
</div>

<script>
/* VARIABLES */
let step = 1;
let firstName = "";
let secondName = "";
let scanner;
let scanLocked = false;

const messages = [
    "A match made in destiny üíï",
    "True love always finds a way üíñ",
    "Perfect chemistry ‚ú®",
    "Two hearts, one story üíû",
    "Love shines brighter together ‚ù§Ô∏è"
];

/* NAVIGATION */
function goGuide() {
    intro.style.display = "none";
    guide.style.display = "block";
}

function startScan() {
    guide.style.display = "none";
    scannerDiv.style.display = "block";

    scanner = new Html5Qrcode("reader");
    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 200 },
        onScanSuccess
    );
}

/* SCAN HANDLER (FIXED NOTIFICATION) */
function onScanSuccess(text) {
    if (scanLocked) return;
    scanLocked = true;

    const name = extractFirstName(text);

    if (step === 1) {
        firstName = name;
        firstResult.innerHTML = "‚úÖ First ID scanned: <b>" + firstName + "</b>";
        scanStatus.innerText = "‚úî First ID recorded. Scan SECOND ID";
        step = 2;

        setTimeout(() => {
            scanLocked = false;
        }, 1500);

    } else if (step === 2 && name !== firstName) {
        secondName = name;
        secondResult.innerHTML = "‚úÖ Second ID scanned: <b>" + secondName + "</b>";
        scanStatus.innerText = "‚úî Both IDs scanned successfully";
        generateBtn.disabled = false;
        scanner.stop();
    }
}

/* GENERATE LOVE TEAM */
function generateLoveTeam() {
    scannerDiv.style.display = "none";
    loading.style.display = "block";

    setTimeout(() => {
        loading.style.display = "none";
        resultSection.style.display = "block";

        loveTeam.innerText = combineNames(firstName, secondName);
        compatibility.innerText = randomPercent() + "%";
        loveMessage.innerText =
            messages[Math.floor(Math.random() * messages.length)];
    }, 5000);
}

/* HELPERS */
function extractFirstName(text) {
    return text.trim().split(" ")[0].replace(/[^A-Za-z]/g, "");
}

function combineNames(a, b) {
    const aPart = a.substring(0, Math.ceil(a.length / 2));
    const bPart = b.substring(Math.floor(b.length / 2));
    const name = aPart + bPart;
    return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
}

function randomPercent() {
    return Math.floor(Math.random() * 21) + 80; // 80‚Äì100%
}

function resetSystem() {
    location.reload();
}

function toggleMusic() {
    const music = document.getElementById("bgMusic");
    music.paused ? music.play() : music.pause();
}

/* ELEMENT REFERENCES */
const intro = document.getElementById("intro");
const guide = document.getElementById("guide");
const scannerDiv = document.getElementById("scanner");
const loading = document.getElementById("loading");
const resultSection = document.getElementById("resultSection");

/* FLYING HEARTS ANIMATION */
function createHeart() {
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.innerHTML = '‚ù§Ô∏è';
    heart.style.left = Math.random() * 100 + 'vw';
    heart.style.animationDelay = Math.random() * 10 + 's';
    document.body.appendChild(heart);
    setTimeout(() => {
        heart.remove();
    }, 10000);
}

setInterval(createHeart, 2000);
</script>

</body>
</html>
